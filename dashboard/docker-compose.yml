version: '3.8'

services:
  # Service Backend
  dashboard-backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: lvm-dashboard-backend
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      - CORS_ORIGIN=http://localhost:3000
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRATION=8h
      - IOT_API_URL=${IOT_API_URL}
      - ML_API_URL=${ML_API_URL}
      - ACCOUNTING_API_URL=${ACCOUNTING_API_URL}
      - MARKETING_API_URL=${MARKETING_API_URL}
      - LOG_LEVEL=info
    volumes:
      - ./backend/logs:/app/logs
    restart: unless-stopped
    networks:
      - dashboard-network

  # Service Frontend
  dashboard-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        - REACT_APP_API_URL=http://localhost:5000/api
        - REACT_APP_SOCKET_URL=http://localhost:5000
    container_name: lvm-dashboard-frontend
    ports:
      - "3000:80"
    depends_on:
      - dashboard-backend
    restart: unless-stopped
    networks:
      - dashboard-network

networks:
  dashboard-network:
    driver: bridge
